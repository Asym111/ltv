{% extends "base.html" %}

{% block topbar_actions %}
<div class="d-flex gap-2 align-items-center">
  <div id="waStatusBadge" class="badge text-bg-secondary">–ü—Ä–æ–≤–µ—Ä–∫–∞‚Ä¶</div>
  <button class="btn btn-sm btn-outline-secondary" type="button" id="waRefreshStatus">
    <i class="bi bi-arrow-repeat"></i>
  </button>
</div>
{% endblock %}

{% block content %}
<div class="row g-3">

  <!-- ‚îÄ‚îÄ –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–¥–Ω–æ–º—É + –®–∞–±–ª–æ–Ω—ã ‚îÄ‚îÄ -->
  <div class="col-12 col-lg-5">

    <!-- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–¥–Ω–æ–º—É –∫–ª–∏–µ–Ω—Ç—É -->
    <div class="card p-3 mb-3">
      <div class="h6 mb-3 d-flex align-items-center gap-2">
        <i class="bi bi-person-fill" style="color:var(--mint)"></i>
        –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É
      </div>

      <div id="waSendErr" class="text-danger small d-none mb-2"></div>
      <div id="waSendOk" class="text-success small d-none mb-2"></div>

      <div class="d-flex flex-column gap-2">
        <div>
          <label class="settings-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
          <input id="waPhone" type="text" class="settings-input mt-1"
                 placeholder="77001234567">
        </div>
        <div>
          <label class="settings-label">–°–æ–æ–±—â–µ–Ω–∏–µ</label>
          <textarea id="waMessage" class="settings-textarea mt-1" rows="4"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω –Ω–∏–∂–µ‚Ä¶"></textarea>
          <div class="d-flex justify-content-between mt-1">
            <span class="text-muted" style="font-size:.75rem">
              –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: {name}, {phone}, {bonus}
            </span>
            <span id="waCharCount" class="text-muted" style="font-size:.75rem">0</span>
          </div>
        </div>
        <button class="btn btn-success" type="button" id="waSendBtn">
          <i class="bi bi-whatsapp me-1"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
        </button>
      </div>
    </div>

    <!-- –®–∞–±–ª–æ–Ω—ã -->
    <div class="card p-3">
      <div class="h6 mb-3 d-flex align-items-center gap-2">
        <i class="bi bi-chat-square-text" style="color:var(--mint)"></i>
        –®–∞–±–ª–æ–Ω—ã
      </div>
      <div id="waTemplatesList" class="d-flex flex-column gap-2">
        <div class="text-muted small">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ ‚îÄ‚îÄ -->
  <div class="col-12 col-lg-7">

    <!-- –†–∞—Å—Å—ã–ª–∫–∞ –ø–æ –∫–∞–º–ø–∞–Ω–∏–∏ -->
    <div class="card p-3 mb-3">
      <div class="h6 mb-3 d-flex align-items-center gap-2">
        <i class="bi bi-megaphone-fill" style="color:var(--mint)"></i>
        –†–∞—Å—Å—ã–ª–∫–∞ –ø–æ –∫–∞–º–ø–∞–Ω–∏–∏
      </div>

      <div class="d-flex flex-column gap-3">
        <div>
          <label class="settings-label">–ö–∞–º–ø–∞–Ω–∏—è</label>
          <select id="waCampaignSelect" class="settings-select mt-1">
            <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–º–ø–∞–Ω–∏—é ‚Äî</option>
          </select>
          <div id="waCampaignInfo" class="text-muted small mt-1 d-none"></div>
        </div>

        <div>
          <label class="settings-label">–®–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è</label>
          <textarea id="waCampaignTemplate" class="settings-textarea mt-1" rows="4"
                    placeholder="–ü—Ä–∏–≤–µ—Ç, {name}! –î–ª—è –≤–∞—Å {bonus} –±–æ–Ω—É—Å–æ–≤ üéÅ"></textarea>
          <div class="d-flex justify-content-between mt-1">
            <span class="text-muted" style="font-size:.75rem">–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: {name}, {phone}, {bonus}, {campaign_name}</span>
          </div>
        </div>

        <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
        <div>
          <div class="d-flex align-items-center justify-content-between mb-1">
            <label class="settings-label">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</label>
            <button class="btn btn-xs" type="button" id="waPreviewBtn">
              <i class="bi bi-eye me-1"></i> –û–±–Ω–æ–≤–∏—Ç—å
            </button>
          </div>
          <div id="waPreviewBox" class="wa-preview-box">
            <div class="text-muted small">–ù–∞–∂–º–∏—Ç–µ ¬´–û–±–Ω–æ–≤–∏—Ç—å¬ª –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞</div>
          </div>
        </div>

        <div id="waCampaignErr" class="text-danger small d-none"></div>
        <div id="waCampaignOk"  class="text-success small d-none"></div>

        <div class="d-flex gap-2">
          <button class="btn btn-outline-secondary" type="button" id="waDryRunBtn">
            <i class="bi bi-eye me-1"></i> –¢–µ—Å—Ç (dry run)
          </button>
          <button class="btn btn-success flex-grow-1" type="button" id="waSendCampaignBtn">
            <i class="bi bi-whatsapp me-1"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
          </button>
        </div>
      </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—Å—ã–ª–∫–∏ -->
    <div id="waResultCard" class="card p-3 d-none">
      <div class="h6 mb-3">–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—Å—ã–ª–∫–∏</div>
      <div id="waResultBody"></div>
    </div>

    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é -->
    <div class="card p-3">
      <div class="h6 mb-2 d-flex align-items-center gap-2">
        <i class="bi bi-info-circle" style="color:var(--mint)"></i>
        –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å GreenAPI
      </div>
      <div class="d-flex flex-column gap-2" style="font-size:.88rem; color:var(--muted)">
        <div class="wa-step">
          <span class="wa-step-num">1</span>
          –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ <a href="https://green-api.com" target="_blank" rel="noopener">green-api.com</a>
          (–µ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ ‚Äî 200 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å—É—Ç–∫–∏)
        </div>
        <div class="wa-step">
          <span class="wa-step-num">2</span>
          –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω—Å—Ç–∞–Ω—Å, –ø–æ–ª—É—á–∏—Ç–µ <strong>Instance ID</strong> –∏ <strong>API Token</strong>
        </div>
        <div class="wa-step">
          <span class="wa-step-num">3</span>
          –î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª <code>.env</code>:<br>
          <code class="wa-code">GREENAPI_INSTANCE_ID=1234567890<br>GREENAPI_API_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω</code>
        </div>
        <div class="wa-step">
          <span class="wa-step-num">4</span>
          –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ WhatsApp —á–µ—Ä–µ–∑ QR-–∫–æ–¥ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ GreenAPI
        </div>
        <div class="wa-step">
          <span class="wa-step-num">5</span>
          –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä ‚Äî —Å—Ç–∞—Ç—É—Å –≤—ã—à–µ —Å—Ç–∞–Ω–µ—Ç <strong class="text-success">–ü–æ–¥–∫–ª—é—á—ë–Ω</strong>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  window.__ADMIN_PAGE__ = "whatsapp";
</script>
{% endblock %}